@page "/admin/users"
@using MMOPortal.Data
@using Microsoft.AspNetCore.Identity
@using Microsoft.AspNetCore.Components.QuickGrid
@using MMOPortal.DTO
@inject UserManager<ApplicationUser> UserManager
@inject ApplicationDbContext DbContext
@rendermode InteractiveServer
<h3>Server</h3>

<DataGrid Items="UserManager.Users">
    <PropertyColumn Property="@(c => c.Id)" Sortable="true"/>
    <PropertyColumn Property="@(c => c.UserName)" Sortable="true"/>
    <PropertyColumn Property="@(c => c.Email)" Sortable="true"/>
    <!--<TemplateColumn Title="Admin">
        <InputCheckbox readonly="readonly" Value="@context.Roles.Contains("Admin")"></InputCheckbox>
    </TemplateColumn>-->
</DataGrid>

@code
{
    IQueryable<UserListDto> Users;

    protected override void OnInitialized()
    {
        var userRoles = DbContext.UserRoles.Join(DbContext.Roles,
            userRole => userRole.RoleId,
            role => role.Id,
            (userRole, applicationRole) => new { userRole.UserId, applicationRole.Name });
        Users = DbContext.Users.OrderBy(dto => dto.Id).GroupJoin(userRoles,
            user => user.Id,
            role => role.UserId,
            (user, roles) => new UserListDto
                (user.Id, user.UserName, user.Email, roles.Select(role => role.Name)));
    }
}